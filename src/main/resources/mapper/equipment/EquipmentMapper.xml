<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wzmtr.eam.mapper.equipment.EquipmentMapper">

    <select id="listTrainRegion" resultType="com.wzmtr.eam.dto.res.basic.RegionResDTO">
        SELECT REC_ID, EQUIP_CODE as NODE_CODE, EQUIP_NAME as NODE_NAME
        FROM T_EQUIPMENT
        WHERE MAJOR_CODE='07' and APPROVAL_STATUS ='30'
        <if test="lineCode!=null and lineCode!=''">
            AND USE_LINE_NO=#{lineCode}
        </if>
        order by EQUIP_CODE asc
    </select>

    <select id="listLine" resultType="com.wzmtr.eam.dto.res.basic.RegionResDTO">
        SELECT ITEM_CODE as REC_ID, 'root' as PARENT_NODE_REC_ID, ITEM_CODE as NODE_CODE, ITEM_CNAME as NODE_NAME, ITEM_CODE as LINE_CODE
        FROM SYS_DICT
        WHERE CODESET_CODE='line'
        ORDER BY ITEM_CODE ASC
    </select>

    <select id="listRegion" resultType="com.wzmtr.eam.dto.res.basic.RegionResDTO">
        SELECT REC_ID, PARENT_NODE_REC_ID, NODE_CODE, NODE_NAME, LINE_CODE
        FROM SYS_REGION
        WHERE DELETE_FLAG='0' and REC_STATUS='10' and LINE_CODE=#{lineCode}
        <if test="regionCode!=null and regionCode!=''">
            and PARENT_NODE_REC_ID=#{recId}
        </if>
        <if test="regionCode==null or regionCode==''">
            and NODE_LEVEL=2
        </if>
        ORDER BY NODE_CODE ASC
    </select>

    <select id="listCarRegion" resultType="com.wzmtr.eam.dto.res.basic.RegionResDTO">
        SELECT REC_ID, #{recId} as PARENT_NODE_REC_ID, EQUIP_CODE as NODE_CODE, EQUIP_NAME as NODE_NAME, USE_LINE_NO as LINE_CODE
        FROM T_EQUIPMENT
        WHERE MAJOR_CODE='07' and APPROVAL_STATUS ='30'
        AND USE_LINE_NO =#{lineCode}
        order by EQUIP_CODE  asc
    </select>

    <select id="listEquipmentCategory" resultType="com.wzmtr.eam.dto.res.basic.EquipmentCategoryResDTO">
        select REC_ID, PARENT_NODE_REC_ID, NODE_CODE, NODE_NAME, #{lineCode} as LINE_CODE,  #{regionCode} as REGION_CODE
        from T_EQUIPMENT_CATEGORY
        where DELETE_FLAG='0' and REC_STATUS='10'
        <if test="equipmentCategoryCode!=null and equipmentCategoryCode!=''">
            and PARENT_NODE_REC_ID=#{recId}
        </if>
        <if test="equipmentCategoryCode==null or equipmentCategoryCode==''">
            and PARENT_NODE_REC_ID='0'
        </if>
        ORDER BY NODE_CODE ASC
    </select>

    <sql id="equip-cols">
        SELECT
        REC_ID	as "recId",  <!-- 记录编号 -->
        COMPANY_CODE	as "companyCode",  <!-- 公司代码 -->
        COMPANY_NAME	as "companyName",  <!-- 公司名称 -->
        DEPT_CODE	as "deptCode",  <!-- 部门代码 -->
        DEPT_NAME	as "deptName",  <!-- 部门名称 -->
        EQUIP_CODE	as "equipCode",  <!-- 设备编码 -->
        EQUIP_NAME	as "equipName",  <!-- 设备名称 -->
        MAJOR_CODE	as "majorCode",  <!-- 专业代码 -->
        MAJOR_NAME	as "majorName",  <!-- 专业名称 -->
        SYSTEM_CODE	as "systemCode",  <!-- 系统代码 -->
        SYSTEM_NAME	as "systemName",  <!-- 系统名称 -->
        EQUIP_TYPE_CODE	as "equipTypeCode",  <!-- 设备分类代码 -->
        EQUIP_TYPE_NAME	as "equipTypeName",  <!-- 设备分类名称 -->
        SPECIAL_EQUIP_FLAG	as "specialEquipFlag",  <!-- 特种设备标识 -->
        SOURCE_KIND	as "sourceKind",  <!-- 设备来源 -->
        BOM_TYPE	as "bomType",  <!-- BOM类型 -->
        MANUFACTURE	as "manufacture",  <!-- 生产厂家 -->
        ORDER_NO	as "orderNo",  <!-- 合同号 -->
        ORDER_NAME	as "orderName",  <!-- 合同名称 -->
        MAT_SPECIFI	as "matSpecifi",  <!-- 型号规格 -->
        BRAND	as "brand",  <!-- 品牌 -->
        MANUFACTURE_DATE	as "manufactureDate",  <!-- 出厂日期 -->
        MANUFACTURE_NO	as "manufactureNo",  <!-- 出厂编号 -->
        START_USE_DATE	as "startUseDate",  <!-- 开始使用日期 -->
        END_USE_TIME	as "endUseTime",  <!-- 停止使用日期 -->
        OTHER_FEATURE	as "otherFeature",  <!-- 其它特征参数 -->
        MEASURE_UNIT	as "measureUnit",  <!-- 计量单位 -->
        QUANTITY	as "quantity",  <!-- 数量 -->
        IN_ACCOUNT_TIME	as "inAccountTime",  <!-- 进设备台帐时间 -->
        PICK_NO	as "pickNo",  <!-- 领用人工号 -->
        PICK_NAME	as "pickName",  <!-- 领用人姓名 -->
        EQUIP_STATUS	as "equipStatus",  <!-- 设备状态 -->
        SOURCE_APP_NO	as "sourceAppNo",  <!-- 来源单号 -->
        SOURCE_SUB_NO	as "sourceSubNo",  <!-- 来源明细号 -->
        SOURCE_REC_ID	as "sourceRecId",  <!-- 来源记录编号 -->
        INSTALL_DEALER	as "installDealer",  <!-- 安装单位 -->
        DOC_ID	as "docId",  <!-- 附件编号 -->
        ORIGIN_LINE_NO	as "originLineNo",  <!-- 来源线别代码 -->
        ORIGIN_LINE_NAME	as "originLineName",  <!-- 来源线别名称 -->
        ORIGIN_SEG_NO	as "originSegNo",  <!-- 来源线段代码 -->
        ORIGIN_SEG_NAME	as "originSegName",  <!-- 来源线段名称 -->
        USE_LINE_NO	as "useLineNo",  <!-- 应用线别代码 -->
        USE_LINE_NAME	as "useLineName",  <!-- 应用线别 -->
        USE_SEG_NO	as "useSegNo",  <!-- 应用线段代码 -->
        USE_SEG_NAME	as "useSegName",  <!-- 应用线段 -->
        POSITION1_CODE	as "position1Code",  <!-- 位置一 -->
        POSITION1_NAME	as "position1Name",  <!-- 位置一名称 -->
        POSITION2_CODE	as "position2Code",  <!-- 位置二 -->
        POSITION2_NAME	as "position2Name",  <!-- 位置二名称 -->
        POSITION3	as "position3",  <!-- 位置三 -->
        POSITION_REMARK	as "positionRemark",  <!-- 位置补充说明 -->
        TOTAL_MILES	as "totalMiles",  <!-- 走行里程 -->
        REMARK	as "remark",  <!-- 备注 -->
        APPROVAL_STATUS	as "approvalStatus",  <!-- 审批状态 -->
        WORK_FLOW_INST_ID	as "workFlowInstId",  <!-- 工作流实例ID -->
        WORK_FLOW_INST_STATUS	as "workFlowInstStatus",  <!-- 工作流实例状态 -->
        VERIFY_DATE	as "verifyDate",  <!-- 特种设备检测日期 -->
        VERIFY_VALIDITY_DATE	as "verifyValidityDate",  <!-- 特种设备检测有效期 -->
        REC_CREATOR	as "recCreator",  <!-- 创建者 -->
        REC_CREATE_TIME	as "recCreateTime",  <!-- 创建时间 -->
        REC_REVISOR	as "recRevisor",  <!-- 修改者 -->
        REC_REVISE_TIME	as "recReviseTime",  <!-- 修改时间 -->
        REC_DELETOR	as "recDeletor",  <!-- 删除者 -->
        REC_DELETE_TIME	as "recDeleteTime",  <!-- 删除时间 -->
        DELETE_FLAG	as "deleteFlag",  <!-- 删除标志 -->
        ARCHIVE_FLAG	as "archiveFlag",  <!-- 归档标记 -->
        REC_STATUS	as "recStatus",  <!-- 记录状态 -->
        EXT1	as "ext1",  <!-- 扩展字段1 -->
        EXT2	as "ext2",  <!-- 扩展字段2 -->
        EXT3	as "ext3",  <!-- 扩展字段3 -->
        EXT4	as "ext4",  <!-- 扩展字段4 -->
        EXT5	as "ext5" <!-- 扩展字段5 -->
    </sql>

    <select id="pageEquipment" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE 1=1 AND APPROVAL_STATUS='30'
        <if test="equipCode!=null and equipCode!=''">
            and EQUIP_CODE like '%' || #{equipCode} || '%'
        </if>
        <if test="equipName!=null and equipName!=''">
            and EQUIP_NAME like '%' || #{equipName} || '%'
        </if>
        <if test="useLineNo!=null and useLineNo!=''">
            and USE_LINE_NO=#{useLineNo}
        </if>
        <if test="useSegNo!=null and useSegNo!=''">
            and USE_SEG_NO=#{useSegNo}
        </if>
        <if test="position1Code!=null and position1Code!=''">
            and POSITION1_CODE=#{position1Code}
        </if>
        <if test="brand!=null and brand!=''">
            and BRAND=#{brand}
        </if>
        <if test="manufacture!=null and manufacture!=''">
            and MANUFACTURE=#{manufacture}
        </if>
        <if test="manufacture!=null and manufacture!=''">
            and MANUFACTURE=#{manufacture}
        </if>
        <if test="startTime!=null and startTime!=''">
            and MANUFACTURE_DATE>=#{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            and #{endTime}>=MANUFACTURE_DATE
        </if>
        <if test="majorCode!=null and majorCode!=''">
            and MAJOR_CODE=#{majorCode}
        </if>
        <if test="systemCode!=null and systemCode!=''">
            and SYSTEM_CODE=#{systemCode}
        </if>
        <if test="equipTypeCode!=null and equipTypeCode!=''">
            and EQUIP_TYPE_CODE=#{equipTypeCode}
        </if>
        ORDER BY EQUIP_CODE ASC
    </select>

    <select id="getEquipmentDetail" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        SELECT
        t1.REC_ID	as "recId",  <!-- 记录编号 -->
        t1.COMPANY_CODE	as "companyCode",  <!-- 公司代码 -->
        t1.COMPANY_NAME	as "companyName",  <!-- 公司名称 -->
        t1.DEPT_CODE	as "deptCode",  <!-- 部门代码 -->
        t1.DEPT_NAME	as "deptName",  <!-- 部门名称 -->
        t1.EQUIP_CODE	as "equipCode",  <!-- 设备编码 -->
        t1.EQUIP_NAME	as "equipName",  <!-- 设备名称 -->
        t1.MAJOR_CODE	as "majorCode",  <!-- 专业代码 -->
        t1.MAJOR_NAME	as "majorName",  <!-- 专业名称 -->
        t1.SYSTEM_CODE	as "systemCode",  <!-- 系统代码 -->
        t1.SYSTEM_NAME	as "systemName",  <!-- 系统名称 -->
        t1.EQUIP_TYPE_CODE	as "equipTypeCode",  <!-- 设备分类代码 -->
        t1.EQUIP_TYPE_NAME	as "equipTypeName",  <!-- 设备分类名称 -->
        t1.SPECIAL_EQUIP_FLAG	as "specialEquipFlag",  <!-- 特种设备标识 -->
        t1.SOURCE_KIND	as "sourceKind",  <!-- 设备来源 -->
        t1.BOM_TYPE	as "bomType",  <!-- BOM类型 -->
        t1.MANUFACTURE	as "manufacture",  <!-- 生产厂家 -->
        t1.ORDER_NO	as "orderNo",  <!-- 合同号 -->
        t1.ORDER_NAME	as "orderName",  <!-- 合同名称 -->
        t1.MAT_SPECIFI	as "matSpecifi",  <!-- 型号规格 -->
        t1.BRAND	as "brand",  <!-- 品牌 -->
        t1.MANUFACTURE_DATE	as "manufactureDate",  <!-- 出厂日期 -->
        t1.MANUFACTURE_NO	as "manufactureNo",  <!-- 出厂编号 -->
        t1.START_USE_DATE	as "startUseDate",  <!-- 开始使用日期 -->
        t1.END_USE_TIME	as "endUseTime",  <!-- 停止使用日期 -->
        t1.OTHER_FEATURE	as "otherFeature",  <!-- 其它特征参数 -->
        t1.MEASURE_UNIT	as "measureUnit",  <!-- 计量单位 -->
        t1.QUANTITY	as "quantity",  <!-- 数量 -->
        t1.IN_ACCOUNT_TIME	as "inAccountTime",  <!-- 进设备台帐时间 -->
        t1.PICK_NO	as "pickNo",  <!-- 领用人工号 -->
        t1.PICK_NAME	as "pickName",  <!-- 领用人姓名 -->
        t1.EQUIP_STATUS	as "equipStatus",  <!-- 设备状态 -->
        t1.SOURCE_APP_NO	as "sourceAppNo",  <!-- 来源单号 -->
        t1.SOURCE_SUB_NO	as "sourceSubNo",  <!-- 来源明细号 -->
        t1.SOURCE_REC_ID	as "sourceRecId",  <!-- 来源记录编号 -->
        t1.INSTALL_DEALER	as "installDealer",  <!-- 安装单位 -->
        t1.DOC_ID	as "docId",  <!-- 附件编号 -->
        t1.ORIGIN_LINE_NO	as "originLineNo",  <!-- 来源线别代码 -->
        t1.ORIGIN_LINE_NAME	as "originLineName",  <!-- 来源线别名称 -->
        t1.ORIGIN_SEG_NO	as "originSegNo",  <!-- 来源线段代码 -->
        t1.ORIGIN_SEG_NAME	as "originSegName",  <!-- 来源线段名称 -->
        t1.USE_LINE_NO	as "useLineNo",  <!-- 应用线别代码 -->
        t1.USE_LINE_NAME	as "useLineName",  <!-- 应用线别 -->
        t1.USE_SEG_NO	as "useSegNo",  <!-- 应用线段代码 -->
        t1.USE_SEG_NAME	as "useSegName",  <!-- 应用线段 -->
        t1.POSITION1_CODE	as "position1Code",  <!-- 位置一 -->
        t1.POSITION1_NAME	as "position1Name",  <!-- 位置一名称 -->
        t1.POSITION2_CODE	as "position2Code",  <!-- 位置二 -->
        t1.POSITION2_NAME	as "position2Name",  <!-- 位置二名称 -->
        t1.POSITION3	as "position3",  <!-- 位置三 -->
        t1.POSITION_REMARK	as "positionRemark",  <!-- 位置补充说明 -->
        t1.TOTAL_MILES	as "totalMiles",  <!-- 走行里程 -->
        t1.REMARK	as "remark",  <!-- 备注 -->
        t1.APPROVAL_STATUS	as "approvalStatus",  <!-- 审批状态 -->
        t1.WORK_FLOW_INST_ID	as "workFlowInstId",  <!-- 工作流实例ID -->
        t1.WORK_FLOW_INST_STATUS	as "workFlowInstStatus",  <!-- 工作流实例状态 -->
        t1.VERIFY_DATE	as "verifyDate",  <!-- 特种设备检测日期 -->
        t1.VERIFY_VALIDITY_DATE	as "verifyValidityDate",  <!-- 特种设备检测有效期 -->
        t2.NAME	as "recCreator",  <!-- 创建者 -->
        t1.REC_CREATE_TIME	as "recCreateTime",  <!-- 创建时间 -->
        t1.REC_REVISOR	as "recRevisor",  <!-- 修改者 -->
        t1.REC_REVISE_TIME	as "recReviseTime",  <!-- 修改时间 -->
        t1.REC_DELETOR	as "recDeletor",  <!-- 删除者 -->
        t1.REC_DELETE_TIME	as "recDeleteTime",  <!-- 删除时间 -->
        t1.DELETE_FLAG	as "deleteFlag",  <!-- 删除标志 -->
        t1.ARCHIVE_FLAG	as "archiveFlag",  <!-- 归档标记 -->
        t1.REC_STATUS	as "recStatus",  <!-- 记录状态 -->
        t1.EXT1	as "ext1",  <!-- 扩展字段1 -->
        t1.EXT2	as "ext2",  <!-- 扩展字段2 -->
        t1.EXT3	as "ext3",  <!-- 扩展字段3 -->
        t1.EXT4	as "ext4",  <!-- 扩展字段4 -->
        t1.EXT5	as "ext5" <!-- 扩展字段5 -->
        FROM T_EQUIPMENT t1
        LEFT JOIN SYS_USER t2 on t1.REC_CREATOR=t2.LOGIN_NAME
        WHERE REC_ID=#{id}
    </select>

    <select id="getEquipmentDetailByCode" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE EQUIP_CODE=#{code}
    </select>

    <select id="getMaxCode" resultType="java.lang.String">
        SELECT
        <if test="type==1">
            max(UNIT_NO)
        </if>
        <if test="type==2">
            max(BATCH_NO)
        </if>
        <if test="type==3">
            max(ASSET_NO)
        </if>
        <if test="type==4">
            max(DEV_NO)
        </if>
        FROM RPLAT60.T_BS_UNITCODE
    </select>

    <insert id="insertUnitCode">
        INSERT INTO RPLAT60.T_BS_UNITCODE (REC_ID,  <!-- 统一编号 -->
        UNIT_NO,  <!-- 合一码,共计11位，以9开头 -->
        BATCH_NO,  <!-- 物资编码(内),共计11位，以1开头 -->
        ASSET_NO,  <!-- 资产编码(内),共计11位，以2开头 -->
        DEV_NO,  <!-- 设备编码(内),共计11位，以8开头 -->
        BATCH_STATUS,  <!-- 添加时为1，更新时为2资产或设备码,3同时有资产时和设备码时1 -->
        ASSET_STATUS,  <!-- 添加时为1，更新时为2物资或设备码,3同时有物资时和设备码时2 -->
        DEV_STATUS,  <!-- 添加时为1，更新时为2资产或物资码,3同时有资产时和物资码时3 -->
        UNITNO_STATUS,  <!-- 记录已有物资，资产及设备状态数量,1有一个有码，2-有二个有码，3-全有码 -->
        STATUS,  <!-- 缺省值为1,21设备被替换，22-资产被替换 23物资被替换 -->
        REP_UNIT_NO,  <!-- 当STATUS=21,22,23时必须有值 -->
        REMARK,  <!-- 备注 -->
        EXT1,  <!-- 扩展字段1 -->
        EXT2,  <!-- 扩展字段2 -->
        EXT3,  <!-- 扩展字段3 -->
        EXT4,  <!-- 扩展字段4 -->
        EXT5,  <!-- 扩展字段5 -->
        REC_CREATOR,  <!-- 记录创建者 -->
        REC_CREATE_TIME,  <!-- 记录创建时间 -->
        REC_REVISOR,  <!-- 记录修改者 -->
        REC_REVISE_TIME,  <!-- 记录修改时间 -->
        REC_DELETOR,  <!-- 记录删除者 -->
        REC_DELETE_TIME,  <!-- 记录删除时间 -->
        DELETE_FLAG,  <!-- 删除标记（0：正常（默认） 1：删除） -->
        ARCHIVE_FLAG,  <!-- 归档标记（0：未归档（默认） 1：归档） -->
        COM_STATUS,  <!-- 是否组合(0:否) -->
        PRO_CODE,
        PRO_NAME,
        ORDER_NO,
        ORDER_NAME,
        SUPPLIER_ID,
        SUPPLIER_NAME,
        MAT_SPECIFI,
        BRAND)
        VALUES (
        #{recId,jdbcType=VARCHAR},
        #{unitNo,jdbcType=VARCHAR},
        #{batchNo,jdbcType=VARCHAR},
        #{assetNo,jdbcType=VARCHAR},
        #{devNo,jdbcType=VARCHAR},
        #{batchStatus,jdbcType=NUMERIC},
        #{assetStatus,jdbcType=NUMERIC},
        #{devStatus,jdbcType=NUMERIC},
        #{unitnoStatus,jdbcType=NUMERIC},
        #{status,jdbcType=NUMERIC},
        #{repUnitNo,jdbcType=VARCHAR},
        #{remark,jdbcType=VARCHAR},
        #{ext1,jdbcType=VARCHAR},
        #{ext2,jdbcType=VARCHAR},
        #{ext3,jdbcType=VARCHAR},
        #{ext4,jdbcType=VARCHAR},
        #{ext5,jdbcType=VARCHAR},
        #{recCreator,jdbcType=VARCHAR},
        #{recCreateTime,jdbcType=VARCHAR},
        #{recRevisor,jdbcType=VARCHAR},
        #{recReviseTime,jdbcType=VARCHAR},
        #{recDeletor,jdbcType=VARCHAR},
        #{recDeleteTime,jdbcType=VARCHAR},
        '0',
        #{archiveFlag,jdbcType=VARCHAR},
        #{comStatus,jdbcType=NUMERIC},
        #{proCode,jdbcType=VARCHAR},
        #{proName,jdbcType=VARCHAR},
        #{orderNo,jdbcType=VARCHAR},
        #{orderName,jdbcType=VARCHAR},
        #{supplierId,jdbcType=VARCHAR},
        #{supplierName,jdbcType=VARCHAR},
        #{matSpecifi,jdbcType=VARCHAR},
        #{brand,jdbcType=VARCHAR})
    </insert>

    <insert id="importEquipment" parameterType="com.wzmtr.eam.dto.req.equipment.EquipmentReqDTO">
        INSERT ALL
        <foreach collection="list" index="index" item="equipment" separator=" ">
            INTO T_EQUIPMENT
            (REC_ID,  <!-- 记录编号 -->
            COMPANY_CODE,  <!-- 公司代码 -->
            COMPANY_NAME,  <!-- 公司名称 -->
            DEPT_CODE,<!-- 部门编码 -->
            DEPT_NAME,<!-- 部门名称 -->
            EQUIP_CODE,  <!-- 设备编码 -->
            EQUIP_NAME,  <!-- 设备名称 -->
            MAJOR_CODE,  <!-- 专业代码 -->
            MAJOR_NAME,  <!-- 专业名称 -->
            SYSTEM_CODE,  <!-- 系统代码 -->
            SYSTEM_NAME,  <!-- 系统名称 -->
            EQUIP_TYPE_CODE,  <!-- 设备分类代码 -->
            EQUIP_TYPE_NAME,  <!-- 设备分类名称 -->
            SPECIAL_EQUIP_FLAG,  <!-- 特种设备标识 -->
            SOURCE_KIND,  <!-- 设备来源 -->
            MANUFACTURE,  <!-- 生产厂家 -->
            MAT_SPECIFI,  <!-- 型号规格 -->
            BRAND,  <!-- 品牌 -->
            MANUFACTURE_DATE,  <!-- 出厂日期 -->
            MANUFACTURE_NO,  <!-- 出厂编号 -->
            START_USE_DATE,  <!-- 开始使用日期 -->
            QUANTITY,  <!-- 数量 -->
            IN_ACCOUNT_TIME,  <!-- 进设备台帐时间 -->
            EQUIP_STATUS,  <!-- 设备状态 -->
            SOURCE_APP_NO,  <!-- 来源单号 -->
            SOURCE_SUB_NO,  <!-- 来源明细号 -->
            SOURCE_REC_ID,  <!-- 来源记录编号 -->
            INSTALL_DEALER,  <!-- 安装单位 -->
            DOC_ID,  <!-- 附件编号 -->
            ORIGIN_LINE_NO,  <!-- 来源线别代码 -->
            ORIGIN_LINE_NAME,  <!-- 来源线别名称 -->
            ORIGIN_SEG_NO,  <!-- 来源线段代码 -->
            ORIGIN_SEG_NAME,  <!-- 来源线段名称 -->
            USE_LINE_NO,  <!-- 应用线别代码 -->
            USE_LINE_NAME,  <!-- 应用线别 -->
            USE_SEG_NO,  <!-- 应用线段代码 -->
            USE_SEG_NAME,  <!-- 应用线段 -->
            POSITION1_CODE,  <!-- 位置一 -->
            POSITION1_NAME,  <!-- 位置一名称 -->
            POSITION2_CODE,  <!-- 位置二 -->
            POSITION2_NAME,  <!-- 位置二名称 -->
            POSITION3,  <!-- 位置三 -->
            POSITION_REMARK,  <!-- 位置补充说明 -->
            TOTAL_MILES,  <!-- 走行里程 -->
            REMARK,  <!-- 备注 -->
            APPROVAL_STATUS,  <!-- 审批状态 -->
            VERIFY_DATE,  <!-- 特种设备检测日期 -->
            VERIFY_VALIDITY_DATE,  <!-- 特种设备检测有效期 -->
            REC_CREATOR,  <!-- 创建者 -->
            REC_CREATE_TIME,  <!-- 创建时间 -->
            REC_REVISOR,  <!-- 修改者 -->
            REC_REVISE_TIME,  <!-- 修改时间 -->
            REC_DELETOR,  <!-- 删除者 -->
            REC_DELETE_TIME,  <!-- 删除时间 -->
            DELETE_FLAG,  <!-- 删除标志 -->
            ARCHIVE_FLAG,  <!-- 归档标记 -->
            REC_STATUS  <!-- 记录状态 -->)
            VALUES
            (SYS_GUID(),
            #{equipment.companyCode},
            #{equipment.companyName},
            #{equipment.deptCode},
            #{equipment.deptName},
            #{equipment.equipCode},
            #{equipment.equipName},
            (SELECT NODE_CODE FROM T_EQUIPMENT_CATEGORY where NODE_NAME=#{equipment.majorName} and NODE_LEVEL=1),
            #{equipment.majorName},
            (SELECT NODE_CODE FROM T_EQUIPMENT_CATEGORY where NODE_NAME=#{equipment.systemName} and NODE_LEVEL=2),
            #{equipment.systemName},
            (SELECT NODE_CODE FROM T_EQUIPMENT_CATEGORY where NODE_NAME=#{equipment.equipTypeName} and NODE_LEVEL=3),
            #{equipment.equipTypeName},
            #{equipment.specialEquipFlag},
            ' ',
            #{equipment.manufacture},
            #{equipment.matSpecifi},
            #{equipment.brand},
            #{equipment.manufactureDate,jdbcType=VARCHAR},
            #{equipment.manufactureNo,jdbcType=VARCHAR},
            #{equipment.startUseDate,jdbcType=VARCHAR},
            #{equipment.quantity,jdbcType=NUMERIC},
            ' ',
            ' ',
            ' ',
            ' ',
            ' ',
            #{equipment.installDealer,jdbcType=VARCHAR},
            ' ',
            ' ',
            ' ',
            ' ',
            ' ',
            #{equipment.useLineNo,jdbcType=VARCHAR},
            #{equipment.useLineName,jdbcType=VARCHAR},
            #{equipment.useSegNo,jdbcType=VARCHAR},
            #{equipment.useSegName,jdbcType=VARCHAR},
            (SELECT NODE_CODE FROM SYS_REGION where NODE_NAME=#{equipment.position1Name,jdbcType=VARCHAR} and LINE_CODE=#{equipment.useLineNo,jdbcType=VARCHAR}),
            #{equipment.position1Name,jdbcType=VARCHAR},
            (SELECT NODE_CODE FROM SYS_REGION where NODE_NAME=#{equipment.position2Name,jdbcType=VARCHAR} and LINE_CODE=#{equipment.useLineNo,jdbcType=VARCHAR}),
            #{equipment.position2Name,jdbcType=VARCHAR},
            #{equipment.position3,jdbcType=VARCHAR},
            #{equipment.positionRemark,jdbcType=VARCHAR},
            0,
            #{equipment.remark,jdbcType=VARCHAR},
            #{equipment.approvalStatus,jdbcType=VARCHAR},
            ' ',
            ' ',
            #{equipment.recCreator},
            #{equipment.recCreateTime},
            ' ',
            ' ',
            ' ',
            ' ',
            '0',
            ' ',
            ' ')
        </foreach>
        SELECT * FROM dual
    </insert>

    <insert id="insertEquipment" parameterType="com.wzmtr.eam.dto.req.equipment.EquipmentReqDTO">
        INSERT INTO T_EQUIPMENT
        (REC_ID,  <!-- 记录编号 -->
        COMPANY_CODE,  <!-- 公司代码 -->
        COMPANY_NAME,  <!-- 公司名称 -->
        DEPT_CODE,<!-- 部门编码 -->
        DEPT_NAME,<!-- 部门名称 -->
        EQUIP_CODE,  <!-- 设备编码 -->
        EQUIP_NAME,  <!-- 设备名称 -->
        MAJOR_CODE,  <!-- 专业代码 -->
        MAJOR_NAME,  <!-- 专业名称 -->
        SYSTEM_CODE,  <!-- 系统代码 -->
        SYSTEM_NAME,  <!-- 系统名称 -->
        EQUIP_TYPE_CODE,  <!-- 设备分类代码 -->
        EQUIP_TYPE_NAME,  <!-- 设备分类名称 -->
        SPECIAL_EQUIP_FLAG,  <!-- 特种设备标识 -->
        SOURCE_KIND,  <!-- 设备来源 -->
        BOM_TYPE,  <!-- BOM类型 -->
        MANUFACTURE,  <!-- 生产厂家 -->
        ORDER_NO,  <!-- 合同号 -->
        ORDER_NAME,  <!-- 合同名称 -->
        MAT_SPECIFI,  <!-- 型号规格 -->
        BRAND,  <!-- 品牌 -->
        MANUFACTURE_DATE,  <!-- 出厂日期 -->
        MANUFACTURE_NO,  <!-- 出厂编号 -->
        START_USE_DATE,  <!-- 开始使用日期 -->
        END_USE_TIME,  <!-- 停止使用日期 -->
        OTHER_FEATURE,  <!-- 其它特征参数 -->
        MEASURE_UNIT,  <!-- 计量单位 -->
        QUANTITY,  <!-- 数量 -->
        IN_ACCOUNT_TIME,  <!-- 进设备台帐时间 -->
        PICK_NO,  <!-- 领用人工号 -->
        PICK_NAME,  <!-- 领用人姓名 -->
        EQUIP_STATUS,  <!-- 设备状态 -->
        SOURCE_APP_NO,  <!-- 来源单号 -->
        SOURCE_SUB_NO,  <!-- 来源明细号 -->
        SOURCE_REC_ID,  <!-- 来源记录编号 -->
        INSTALL_DEALER,  <!-- 安装单位 -->
        DOC_ID,  <!-- 附件编号 -->
        ORIGIN_LINE_NO,  <!-- 来源线别代码 -->
        ORIGIN_LINE_NAME,  <!-- 来源线别名称 -->
        ORIGIN_SEG_NO,  <!-- 来源线段代码 -->
        ORIGIN_SEG_NAME,  <!-- 来源线段名称 -->
        USE_LINE_NO,  <!-- 应用线别代码 -->
        USE_LINE_NAME,  <!-- 应用线别 -->
        USE_SEG_NO,  <!-- 应用线段代码 -->
        USE_SEG_NAME,  <!-- 应用线段 -->
        POSITION1_CODE,  <!-- 位置一 -->
        POSITION1_NAME,  <!-- 位置一名称 -->
        POSITION2_CODE,  <!-- 位置二 -->
        POSITION2_NAME,  <!-- 位置二名称 -->
        POSITION3,  <!-- 位置三 -->
        POSITION_REMARK,  <!-- 位置补充说明 -->
        TOTAL_MILES,  <!-- 走行里程 -->
        REMARK,  <!-- 备注 -->
        APPROVAL_STATUS,  <!-- 审批状态 -->
        WORK_FLOW_INST_ID,  <!-- 工作流实例ID -->
        WORK_FLOW_INST_STATUS,  <!-- 工作流实例状态 -->
        VERIFY_DATE,  <!-- 特种设备检测日期 -->
        VERIFY_VALIDITY_DATE,  <!-- 特种设备检测有效期 -->
        REC_CREATOR,  <!-- 创建者 -->
        REC_CREATE_TIME,  <!-- 创建时间 -->
        REC_REVISOR,  <!-- 修改者 -->
        REC_REVISE_TIME,  <!-- 修改时间 -->
        REC_DELETOR,  <!-- 删除者 -->
        REC_DELETE_TIME,  <!-- 删除时间 -->
        DELETE_FLAG,  <!-- 删除标志 -->
        ARCHIVE_FLAG,  <!-- 归档标记 -->
        REC_STATUS,  <!-- 记录状态 -->
        EXT1,  <!-- 扩展字段1 -->
        EXT2,  <!-- 扩展字段2 -->
        EXT3,  <!-- 扩展字段3 -->
        EXT4,  <!-- 扩展字段4 -->
        EXT5  <!-- 扩展字段5 -->)
        VALUES
        (#{recId,jdbcType=VARCHAR},
        #{companyCode,jdbcType=VARCHAR},
        #{companyName,jdbcType=VARCHAR},
        #{deptCode,jdbcType=VARCHAR},
        #{deptName,jdbcType=VARCHAR},
        #{equipCode,jdbcType=VARCHAR},
        #{equipName,jdbcType=VARCHAR},
        #{majorCode,jdbcType=VARCHAR},
        #{majorName,jdbcType=VARCHAR},
        #{systemCode,jdbcType=VARCHAR},
        #{systemName,jdbcType=VARCHAR},
        #{equipTypeCode,jdbcType=VARCHAR},
        #{equipTypeName,jdbcType=VARCHAR},
        #{specialEquipFlag,jdbcType=VARCHAR},
        #{sourceKind,jdbcType=VARCHAR},
        #{bomType,jdbcType=VARCHAR},
        #{manufacture,jdbcType=VARCHAR},
        #{orderNo,jdbcType=VARCHAR},
        #{orderName,jdbcType=VARCHAR},
        #{matSpecifi,jdbcType=VARCHAR},
        #{brand,jdbcType=VARCHAR},
        #{manufactureDate,jdbcType=VARCHAR},
        #{manufactureNo,jdbcType=VARCHAR},
        #{startUseDate,jdbcType=VARCHAR},
        #{endUseTime,jdbcType=VARCHAR},
        #{otherFeature,jdbcType=VARCHAR},
        #{measureUnit,jdbcType=VARCHAR},
        #{quantity,jdbcType=NUMERIC},
        #{inAccountTime,jdbcType=VARCHAR},
        #{pickNo,jdbcType=VARCHAR},
        #{pickName,jdbcType=VARCHAR},
        #{equipStatus,jdbcType=VARCHAR},
        #{sourceAppNo,jdbcType=VARCHAR},
        #{sourceSubNo,jdbcType=VARCHAR},
        #{sourceRecId,jdbcType=VARCHAR},
        #{installDealer,jdbcType=VARCHAR},
        #{docId,jdbcType=VARCHAR},
        #{originLineNo,jdbcType=VARCHAR},
        #{originLineName,jdbcType=VARCHAR},
        #{originSegNo,jdbcType=VARCHAR},
        #{originSegName,jdbcType=VARCHAR},
        #{useLineNo,jdbcType=VARCHAR},
        #{useLineName,jdbcType=VARCHAR},
        #{useSegNo,jdbcType=VARCHAR},
        #{useSegName,jdbcType=VARCHAR},
        #{position1Code,jdbcType=VARCHAR},
        #{position1Name,jdbcType=VARCHAR},
        #{position2Code,jdbcType=VARCHAR},
        #{position2Name,jdbcType=VARCHAR},
        #{position3,jdbcType=VARCHAR},
        #{positionRemark,jdbcType=VARCHAR},
        #{totalMiles,jdbcType=NUMERIC},
        #{remark,jdbcType=VARCHAR},
        #{approvalStatus,jdbcType=VARCHAR},
        #{workFlowInstId,jdbcType=VARCHAR},
        #{workFlowInstStatus,jdbcType=VARCHAR},
        #{verifyDate,jdbcType=VARCHAR},
        #{verifyValidityDate,jdbcType=VARCHAR},
        #{recCreator,jdbcType=VARCHAR},
        #{recCreateTime,jdbcType=VARCHAR},
        #{recRevisor,jdbcType=VARCHAR},
        #{recReviseTime,jdbcType=VARCHAR},
        #{recDeletor,jdbcType=VARCHAR},
        #{recDeleteTime,jdbcType=VARCHAR},
        '0',
        #{archiveFlag,jdbcType=VARCHAR},
        #{recStatus,jdbcType=VARCHAR},
        #{ext1,jdbcType=VARCHAR},
        #{ext2,jdbcType=VARCHAR},
        #{ext3,jdbcType=VARCHAR},
        #{ext4,jdbcType=VARCHAR},
        #{ext5,jdbcType=VARCHAR})
    </insert>

    <select id="listEquipment" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE
<!--        USE_LINE_NO='02' and MAJOR_CODE='07'-->
        REC_ID IN (
        <foreach collection="ids" index="index" item="id" separator=",">
            #{id}
        </foreach>
        )
        ORDER BY EQUIP_CODE ASC
    </select>

    <select id="siftEquipment" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE 1=1
        <if test="bomType!=null and bomType!=''">
            and TRIM(BOM_TYPE) IS NOT NULL AND MAJOR_CODE ='07'
        </if>
        <if test="sourceRecId!=null and sourceRecId!=''">
            and SOURCE_REC_ID=#{sourceRecId}
        </if>
        <if test="approvalStatus!=null and approvalStatus!=''">
            and APPROVAL_STATUS=#{approvalStatus}
        </if>
        <if test="equipCode!=null and equipCode!=''">
            and EQUIP_CODE like '%' || #{equipCode} || '%'
        </if>
        <if test="equipName!=null and equipName!=''">
            and EQUIP_NAME like '%' || #{equipName} || '%'
        </if>
        <if test="useLineNo!=null and useLineNo!=''">
            and USE_LINE_NO=#{useLineNo}
        </if>
        <if test="useSegNo!=null and useSegNo!=''">
            and USE_SEG_NO=#{useSegNo}
        </if>
        <if test="position1Code!=null and position1Code!=''">
            and POSITION1_CODE=#{position1Code}
        </if>
        <if test="specialEquipFlag!=null and specialEquipFlag!=''">
            and SPECIAL_EQUIP_FLAG=#{specialEquipFlag}
        </if>
        <if test="brand!=null and brand!=''">
            and BRAND=#{brand}
        </if>
        <if test="equipStatus!=null and equipStatus!=''">
            and EQUIP_STATUS=#{equipStatus}
        </if>
        <if test="manufacture!=null and manufacture!=''">
            and MANUFACTURE=#{manufacture}
        </if>
        <if test="startTime!=null and startTime!=''">
            and MANUFACTURE_DATE>=#{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            and #{endTime}>=MANUFACTURE_DATE
        </if>
        <if test="majorCode!=null and majorCode!=''">
            and MAJOR_CODE=#{majorCode}
        </if>
        <if test="systemCode!=null and systemCode!=''">
            and SYSTEM_CODE=#{systemCode}
        </if>
        <if test="equipTypeCode!=null and equipTypeCode!=''">
            and EQUIP_TYPE_CODE=#{equipTypeCode}
        </if>
        <if test="subjectCode!=null and subjectCode!=''">
            and MAJOR_CODE=#{subjectCode}
        </if>
        <if test="lineNo!=null and lineNo!=''">
            and USE_LINE_NO=#{lineNo}
        </if>
        ORDER BY EQUIP_CODE ASC
    </select>

    <select id="getSplitTransferDetail" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE 1=1 and REC_ID=#{id}
        ORDER BY EQUIP_CODE ASC
    </select>

    <select id="selectByEquipName" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        SELECT
        EQUIP_CODE as equipCode,
        EQUIP_NAME as equipName
        from T_EQUIPMENT where
        MAJOR_CODE='07'
        <if test="equipName!=null and equipName!=''">
            and EQUIP_NAME = #{equipName}
        </if>
        order by EQUIP_NAME
    </select>


    <select id="queryMajor" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO" >
        select
            MAJOR_CODE as "majorCode",
            USE_LINE_NO as "useLineNo"
        from T_EQUIPMENT
        where EQUIP_NAME = #{equipName}
    </select>

    <update id="updateEquipment">
        UPDATE T_EQUIPMENT SET
        <if test="companyCode!=null">
            COMPANY_CODE=#{companyCode},   <!-- 公司代码 -->
        </if>
        <if test="companyName!=null">
            COMPANY_NAME=#{companyName},   <!-- 公司名称 -->
        </if>
        <if test="deptCode!=null">
            DEPT_CODE=#{deptCode},   <!-- 公司代码 -->
        </if>
        <if test="deptName!=null">
            DEPT_NAME=#{deptName},   <!-- 公司名称 -->
        </if>
        <if test="equipCode!=null">
            EQUIP_CODE=#{equipCode},   <!-- 设备编码 -->
        </if>
        <if test="equipName!=null">
            EQUIP_NAME=#{equipName},   <!-- 设备名称 -->
        </if>
        <if test="majorCode!=null">
            MAJOR_CODE=#{majorCode},   <!-- 专业代码 -->
        </if>
        <if test="majorName!=null">
            MAJOR_NAME=#{majorName},   <!-- 专业名称 -->
        </if>
        <if test="systemCode!=null">
            SYSTEM_CODE=#{systemCode},   <!-- 系统代码 -->
        </if>
        <if test="systemName!=null">
            SYSTEM_NAME=#{systemName},   <!-- 系统名称 -->
        </if>
        <if test="equipTypeCode!=null">
            EQUIP_TYPE_CODE=#{equipTypeCode},   <!-- 设备分类代码 -->
        </if>
        <if test="equipTypeName!=null">
            EQUIP_TYPE_NAME=#{equipTypeName},   <!-- 设备分类名称 -->
        </if>
        <if test="specialEquipFlag!=null">
            SPECIAL_EQUIP_FLAG=#{specialEquipFlag},   <!-- 特种设备标识 -->
        </if>
        <if test="sourceKind!=null">
            SOURCE_KIND=#{sourceKind},   <!-- 设备来源 -->
        </if>
        <if test="bomType!=null">
            BOM_TYPE=#{bomType},   <!-- BOM类型 -->
        </if>
        <if test="manufacture!=null">
            MANUFACTURE=#{manufacture},   <!-- 生产厂家 -->
        </if>
        <if test="orderNo!=null">
            ORDER_NO=#{orderNo},   <!-- 合同号 -->
        </if>
        <if test="orderName!=null">
            ORDER_NAME=#{orderName},   <!-- 合同名称 -->
        </if>
        <if test="matSpecifi!=null">
            MAT_SPECIFI=#{matSpecifi},   <!-- 型号规格 -->
        </if>
        <if test="brand!=null">
            BRAND=#{brand},   <!-- 品牌 -->
        </if>
        <if test="manufactureDate!=null">
            MANUFACTURE_DATE=#{manufactureDate},   <!-- 出厂日期 -->
        </if>
        <if test="manufactureNo!=null">
            MANUFACTURE_NO=#{manufactureNo},   <!-- 出厂编号 -->
        </if>
        <if test="startUseDate!=null">
            START_USE_DATE=#{startUseDate},   <!-- 开始使用日期 -->
        </if>
        <if test="endUseTime!=null">
            END_USE_TIME=#{endUseTime},   <!-- 停止使用日期 -->
        </if>
        <if test="otherFeature!=null">
            OTHER_FEATURE=#{otherFeature},   <!-- 其它特征参数 -->
        </if>
        <if test="measureUnit!=null">
            MEASURE_UNIT=#{measureUnit},   <!-- 计量单位 -->
        </if>
        <if test="quantity!=null">
            QUANTITY=#{quantity,jdbcType=NUMERIC},   <!-- 数量 -->
        </if>
        <if test="inAccountTime!=null">
            IN_ACCOUNT_TIME=#{inAccountTime},   <!-- 进设备台帐时间 -->
        </if>
        <if test="pickNo!=null">
            PICK_NO=#{pickNo},   <!-- 领用人工号 -->
        </if>
        <if test="pickName!=null">
            PICK_NAME=#{pickName},   <!-- 领用人姓名 -->
        </if>
        <if test="equipStatus!=null">
            EQUIP_STATUS=#{equipStatus},   <!-- 设备状态 -->
        </if>
        <if test="sourceAppNo!=null">
            SOURCE_APP_NO=#{sourceAppNo},   <!-- 来源单号 -->
        </if>
        <if test="sourceSubNo!=null">
            SOURCE_SUB_NO=#{sourceSubNo},   <!-- 来源明细号 -->
        </if>
        <if test="sourceRecId!=null">
            SOURCE_REC_ID=#{sourceRecId},   <!-- 来源记录编号 -->
        </if>
        <if test="installDealer!=null">
            INSTALL_DEALER=#{installDealer},   <!-- 安装单位 -->
        </if>
        <if test="docId!=null">
            DOC_ID=#{docId},   <!-- 附件编号 -->
        </if>
        <if test="originLineNo!=null">
            ORIGIN_LINE_NO=#{originLineNo},   <!-- 来源线别代码 -->
        </if>
        <if test="originLineName!=null">
            ORIGIN_LINE_NAME=#{originLineName},   <!-- 来源线别名称 -->
        </if>
        <if test="originSegNo!=null">
            ORIGIN_SEG_NO=#{originSegNo},   <!-- 来源线段代码 -->
        </if>
        <if test="originSegName!=null">
            ORIGIN_SEG_NAME=#{originSegName},   <!-- 来源线段名称 -->
        </if>
        <if test="useLineNo!=null">
            USE_LINE_NO=#{useLineNo},   <!-- 应用线别代码 -->
        </if>
        <if test="useLineName!=null">
            USE_LINE_NAME=#{useLineName},   <!-- 应用线别 -->
        </if>
        <if test="useSegNo!=null">
            USE_SEG_NO=#{useSegNo},   <!-- 应用线段代码 -->
        </if>
        <if test="useSegName!=null">
            USE_SEG_NAME=#{useSegName},   <!-- 应用线段 -->
        </if>
        <if test="position1Code!=null">
            POSITION1_CODE=#{position1Code},   <!-- 位置一 -->
        </if>
        <if test="position1Name!=null">
            POSITION1_NAME=#{position1Name},   <!-- 位置一名称 -->
        </if>
        <if test="position2Code!=null">
            POSITION2_CODE=#{position2Code},   <!-- 位置二 -->
        </if>
        <if test="position2Name!=null">
            POSITION2_NAME=#{position2Name},   <!-- 位置二名称 -->
        </if>
        <if test="position3!=null">
            POSITION3=#{position3},   <!-- 位置三 -->
        </if>
        <if test="positionRemark!=null">
            POSITION_REMARK=#{positionRemark},   <!-- 位置补充说明 -->
        </if>
        <if test="totalMiles!=null">
            TOTAL_MILES=#{totalMiles,jdbcType=NUMERIC},   <!-- 走行里程 -->
        </if>
        <if test="remark!=null">
            REMARK=#{remark},   <!-- 备注 -->
        </if>
        <if test="approvalStatus!=null">
            APPROVAL_STATUS=#{approvalStatus},   <!-- 审批状态 -->
        </if>
        <if test="workFlowInstId!=null">
            WORK_FLOW_INST_ID=#{workFlowInstId},   <!-- 工作流实例ID -->
        </if>
        <if test="workFlowInstStatus!=null">
            WORK_FLOW_INST_STATUS=#{workFlowInstStatus},   <!-- 工作流实例状态 -->
        </if>
        <if test="verifyDate!=null">
            VERIFY_DATE=#{verifyDate},   <!-- 特种设备检测日期 -->
        </if>
        <if test="verifyValidityDate!=null">
            VERIFY_VALIDITY_DATE=#{verifyValidityDate},   <!-- 特种设备检测有效期 -->
        </if>
        <if test="archiveFlag!=null">
            ARCHIVE_FLAG=#{archiveFlag},   <!-- 归档标记 -->
        </if>
        <if test="recStatus!=null">
            REC_STATUS=#{recStatus},   <!-- 记录状态 -->
        </if>
        <if test="ext1!=null">
            EXT1=#{ext1},   <!-- 扩展字段1 -->
        </if>
        <if test="ext2!=null">
            EXT2=#{ext2},   <!-- 扩展字段2 -->
        </if>
        <if test="ext3!=null">
            EXT3=#{ext3},   <!-- 扩展字段3 -->
        </if>
        <if test="ext4!=null">
            EXT4=#{ext4},   <!-- 扩展字段4 -->
        </if>
        <if test="ext5!=null">
            EXT5=#{ext5},  <!-- 扩展字段5 -->
        </if>
        REC_REVISOR=#{recRevisor},   <!-- 修改者 -->
        REC_REVISE_TIME=#{recReviseTime}   <!-- 修改时间 -->
        WHERE REC_ID = #{recId}
    </update>

    <select id="listOverhaul" resultType="com.wzmtr.eam.dto.res.overhaul.OverhaulOrderDetailResDTO">
        SELECT
        REC_ID	as "recId",  <!-- 记录ID -->
        ORDER_CODE	as "orderCode",  <!-- 检修工单 -->
        OBJECT_CODE	as "objectCode",  <!-- 对象编码 -->
        OBJECT_NAME	as "objectName",  <!-- 对象名称 -->
        REPAIR_STATUS	as "repairStatus",  <!-- 检修情况 -->
        REPAIR_DETAIL	as "repairDetail",  <!-- 检修情况说明 -->
        START_TIME	as "startTime",  <!-- 开始时间 -->
        COMPLITE_TIME	as "compliteTime",  <!-- 结束时间 -->
        ABNORMAL_NUMBER	as "abnormalNumber" <!-- 异常数量 -->
        FROM T_OVERHAUL_ORDER_DETAIL WHERE 1=1 AND OBJECT_CODE=#{equipCode}
        order by ORDER_CODE desc
    </select>

    <select id="listFault" resultType="com.wzmtr.eam.dto.res.fault.FaultDetailResDTO">
        SELECT
        a.DISCOVERER_NAME as "discovererName",
        a.DISCOVERY_TIME as "discoveryTime",
        a.FAULT_DETAIL as "faultDisplayDetail",
        b.FAULT_REASON_DETAIL as "faultReasonDetail",
        b.FAULT_ACTION_DETAIL as "faultActionDetail",
        b.REPAIR_END_TIME as "repairEndTime"
        FROM T_FAULT_INFO a
        LEFT JOIN T_FAULT_ORDER b ON a.FAULT_NO=b.FAULT_NO
        WHERE 1=1 AND a.OBJECT_CODE=#{equipCode}
        order by a.FAULT_NO desc
    </select>

    <select id="listPartReplace" resultType="com.wzmtr.eam.dto.res.equipment.PartReplaceResDTO">
        SELECT
        REC_ID	as "recId",  <!-- 记录编号 -->
        FAULT_WORK_NO	as "faultWorkNo",  <!-- 故障工单编号 -->
        EQUIP_CODE	as "equipCode",  <!-- 设备代码 -->
        EQUIP_NAME	as "equipName",  <!-- 设备名称 -->
        ORG_TYPE	as "orgType",  <!-- 作业单位 -->
        OPERATOR	as "operator",  <!-- 作业人员 -->
        REPLACEMENT_NO	as "replacementNo",  <!-- 更换配件代码 -->
        REPLACEMENT_NAME	as "replacementName",  <!-- 更换配件名称 -->
        REPLACE_REASON	as "replaceReason",  <!-- 更换原因 -->
        OLD_REP_NO	as "oldRepNo",  <!-- 旧配件编号 -->
        NEW_REP_NO	as "newRepNo",  <!-- 新配件编号 -->
        OPERATE_COST_TIME	as "operateCostTime",  <!-- 更换所用时间 -->
        REPLACE_DATE	as "replaceDate",  <!-- 处理日期 -->
        REMARK	as "remark",  <!-- 备注 -->
        DOC_ID	as "docId",  <!-- 附件编号 -->
        REC_CREATOR	as "recCreator",  <!-- 创建者 -->
        REC_CREATE_TIME	as "recCreateTime",  <!-- 创建时间 -->
        REC_REVISOR	as "recRevisor",  <!-- 修改者 -->
        REC_REVISE_TIME	as "recReviseTime",  <!-- 修改时间 -->
        REC_DELETOR	as "recDeletor",  <!-- 删除者 -->
        REC_DELETE_TIME	as "recDeleteTime",  <!-- 删除时间 -->
        DELETE_FLAG	as "deleteFlag",  <!-- 删除标志 -->
        ARCHIVE_FLAG	as "archiveFlag",  <!-- 归档标记 -->
        REC_STATUS	as "recStatus",  <!-- 记录状态 -->
        EXT1	as "ext1",  <!-- 扩展字段1 -->
        EXT2	as "ext2",  <!-- 扩展字段2 -->
        EXT3	as "ext3",  <!-- 扩展字段3 -->
        EXT4	as "ext4",  <!-- 扩展字段4 -->
        EXT5	as "ext5",  <!-- 扩展字段5 -->
        EXT6	as "ext6",  <!-- 扩展字段6 -->
        EXT7	as "ext7" <!-- 扩展字段7 -->
        FROM T_PART_REPLACEMENT
        WHERE 1=1 and DELETE_FLAG='0' AND EQUIP_CODE=#{equipCode}
        ORDER BY REPLACE_DATE desc, REC_CREATE_TIME desc
    </select>
    <select id="queryLine" resultType="com.wzmtr.eam.dto.res.basic.LineResDTO">
        SELECT
        db.LINE_CODE as "lineCode",
        ec.ITEM_CNAME as "lineName"
        FROM SYS_REGION db,iplat60.tedcm01 ec
        where db.LINE_CODE = ec.ITEM_CODE and ec.CODESET_CODE='line'
        <if test="recId!=null">
           and db.REC_ID = #{recId}
        </if>
        order by db.NODE_CODE asc
    </select>
    <select id="queryCarLine" resultType="com.wzmtr.eam.dto.res.basic.LineResDTO">
        SELECT
        ITEM_CODE as "lineCode",
        ITEM_CNAME as "lineName"
        FROM iplat60.tedcm01
        where CODESET_CODE='line'
        <if test="lineCode!=null">
            and ITEM_CODE=#{lineCode}
        </if>
    </select>

    <select id="getEquipByName" resultType="com.wzmtr.eam.dto.res.equipment.EquipmentResDTO">
        <include refid="equip-cols"/>
        FROM T_EQUIPMENT WHERE EQUIP_NAME=#{name} AND DELETE_FLAG='0'
        AND ROWNUM=1
    </select>


</mapper>