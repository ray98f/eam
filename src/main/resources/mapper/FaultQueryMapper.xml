<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wzmtr.eam.mapper.fault.FaultQueryMapper">

    <!--dmfm01.query -->
    <select id="query" resultType="com.wzmtr.eam.dto.res.fault.FaultDetailResDTO">
        SELECT
        d.REC_ID AS "faultInfoRecId",
        df.REC_ID AS "faultOrderRecId",
        df.WORK_CLASS AS "workClass",
        d.COMPANY_CODE AS "companyCode",
        d.COMPANY_NAME AS "companyName",
        d.FAULT_NO AS "faultNo",
        d.FAULT_FLAG AS "faultFlag",
        d.OBJECT_CODE AS "objectCode",
        d.OBJECT_CODE AS "objectCode_textField",
        d.OBJECT_NAME AS "objectName",
        d.TRAIN_TRUNK AS "trainTrunk",
        ( SELECT ec.ITEM_CNAME FROM iplat60.tedcm01 ec WHERE ec.ITEM_CODE=d.LINE_CODE AND ec.CODESET_CODE='line' )
        AS
        "lineName",
        d.LINE_CODE AS "lineCode",
        d.POSITION_CODE AS "positionCode",
        d.POSITION2_CODE AS "position2Code",
        d.PART_CODE AS "partCode",
        d.PART_NAME AS "partName",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.MAJOR_CODE ) AS "majorName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.SYSTEM_CODE ) AS "systemName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.EQUIP_TYPE_CODE ) AS "equipTypeName",
        ( SELECT d3.NODE_NAME FROM SYS_REGION d3 WHERE d3.NODE_CODE=d.EXT1 ) AS "stationCode",
        d.MAJOR_CODE AS "majorCode",
        d.SYSTEM_CODE AS "systemCode",
        d.EQUIP_TYPE_CODE AS "equipTypeCode",
        d.FAULT_MODULE AS "faultModule",
        d.FAULT_MODULE_ID AS "faultModuleId",
        d.FAULT_TYPE AS "faultType",
        d.SOURCE_CODE AS "sourceCode",
        d.FAULT_DISPLAY_CODE AS "faultDisplayCode",
        d.FAULT_DISPLAY_DETAIL AS "faultDisplayDetail",
        d.FAULT_DETAIL AS "faultDetail",
        d.DISCOVERER_ID AS "discovererId",
        d.DISCOVERER_PHONE AS "discovererPhone",
        d.DISCOVERER_NAME AS "discovererName",
        d.DISCOVERY_TIME AS "discoveryTime",
        d.FILLIN_USER_ID AS "fillinUserId",
        d.FILLIN_DEPT_CODE AS "fillinDeptCode",
        d.FILLIN_TIME AS "fillinTime",
        d.RESP_DEPT_CODE AS "respDeptCode",
        d.ASSIST_DEPT_CODE AS "assistDeptCode",
        d.REPAIR_DEPT_CODE AS "repairDeptCode",
        d.PUBLISH_USER_ID AS "publishUserId",
        d.PUBLISH_TIME AS "publishTime",
        d.FAULT_LEVEL AS "faultLevel",
        d.FAULT_STATUS AS "faultStatus",
        d.WORK_FLOW_INST_ID AS "workFlowInstId",
        d.WORK_FLOW_INST_STATUS AS "workFlowInstStatus",
        d.DOC_ID AS "docId",
        d.REMARK AS "remark",
        d.REC_CREATOR AS "recCreator",
        d.REC_CREATE_TIME AS "recCreateTime",
        d.REC_REVISOR AS "recRevisor",
        d.REC_REVISE_TIME AS "recReviseTime",
        d.REC_DELETOR AS "recDeletor",
        d.REC_DELETE_TIME AS "recDeleteTime",
        d.DELETE_FLAG AS "deleteFlag",
        d.ARCHIVE_FLAG AS "archiveFlag",
        d.REC_STATUS AS "recStatus",
        d.EXT1 AS "ext1",
        d.EXT2 AS "ext2",
        d.EXT3 AS "affect",
        d.EXT4 AS "ext4",
        d.EXT5 AS "ext5",
        d.TRAIN_TAG AS "traintag",
        u.USER_NAME AS "fillinUserName",
        df.CLOSE_TIME AS "closeTime",
        ( SELECT u1.USER_NAME FROM IPLAT60.XS_USER u1 WHERE u1.LOGIN_NAME=df.CLOSE_USER_ID ) AS "closeUserName",
        df.DEALER_UNIT AS "dealerUnit",
        df.FAULT_PROCESS_RESULT AS "faultProcessResult",
        df.DEALER_NUM AS "dealerNum",
        df.FAULT_WORK_NO AS "faultWorkNo",
        df.REC_ID AS "orderRecId",
        df.ORDER_STATUS AS "orderStatus",
        df.EXT1 AS "levelfault"
        FROM
        T_FAULT_INFO d,
        IPLAT60.XS_USER u,
        T_FAULT_ORDER df
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="req.faultType!=null and req.faultType!=''">
                AND d.FAULT_TYPE=#{req.faultType}
            </if>
            <if test="req.positionCode!=null and req.positionCode!=''">
                AND d.POSITION_CODE=#{req.positionCode}
            </if>
            <if test="req.faultNo!=null and req.faultNo!=''">
                AND d.FAULT_NO = #{req.faultNo}
            </if>
            <if test="req.faultWorkNo!=null and req.faultWorkNo!=''">
                AND df.FAULT_WORK_NO =#{req.faultWorkNo}
            </if>
            <if test="req.orderStatus!=null and req.orderStatus!=''">
                AND df.ORDER_STATUS=#{req.orderStatus}
            </if>
            <if test="req.invalid != null and 'true'.toString() == req.invalid.toString()">
                AND df.ORDER_STATUS = '99'
            </if>
            <if test="req.lineCode!=null and req.lineCode!=''">
                AND d.LINE_CODE=#{req.lineCode}
            </if>
            <if test="req.objectCode!=null and req.objectCode!=''">
                AND d.OBJECT_CODE=#{req.objectCode}
            </if>
            <if test="req.objectName!=null and req.objectName!=''">
                AND d.OBJECT_NAME=#{req.objectName}
            </if>
            <if test="req.majorCode!=null and req.majorCode!=''">
                AND d.MAJOR_CODE=#{req.majorCode}
            </if>
            <if test="req.systemCode!=null and req.systemCode!=''">
                AND d.SYSTEM_CODE=#{req.systemCode}
            </if>
            <if test="req.equipTypeCode!=null and req.equipTypeCode!=''">
                AND d.EQUIP_TYPE_CODE=#{req.equipTypeCode}
            </if>
            <if test="req.faultDetail!=null and req.faultDetail!=''">
                AND d.FAULT_DETAIL LIKE '%' || #{req.faultDetail} || '%'
            </if>
            <if test="req.fillinTimeStart!=null and req.fillinTimeStart!=''">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &gt;= to_date(#{req.fillinTimeStart}, 'YYYY-MM-DD')
            </if>
            <if test="req.fillinTimeEnd!=null and req.fillinTimeEnd!=''">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &lt;= to_date(#{req.fillinTimeEnd}, 'YYYY-MM-DD') +
                1
            </if>
            AND d.FILLIN_USER_ID=u.LOGIN_NAME
            AND d.FAULT_NO=df.FAULT_NO
            AND d.FAULT_FLAG <![CDATA[!=]]> '2'
            and d.DELETE_FLAG = '0'
        </trim>
        ORDER BY d.FAULT_NO desc,df.FAULT_WORK_NO desc
    </select>
    <select id="list" resultType="com.wzmtr.eam.dto.res.fault.FaultDetailResDTO">
        SELECT
        d.REC_ID AS "recId",
        df.REC_ID AS "workId",
        df.WORK_CLASS AS "workClass",
        d.COMPANY_CODE AS "companyCode",
        d.COMPANY_NAME AS "companyName",
        d.FAULT_NO AS "faultNo",
        d.FAULT_FLAG AS "faultFlag",
        d.OBJECT_CODE AS "objectCode",
        d.OBJECT_CODE AS "objectCode_textField",
        d.OBJECT_NAME AS "objectName",
        d.TRAIN_TRUNK AS "trainTrunk",
        ( SELECT ec.ITEM_CNAME FROM iplat60.tedcm01 ec WHERE ec.ITEM_CODE=d.LINE_CODE AND ec.CODESET_CODE='line' )
        AS
        "lineName",
        d.LINE_CODE AS "lineCode",
        d.POSITION_CODE AS "positionCode",
        d.POSITION2_CODE AS "position2Code",
        d.PART_CODE AS "partCode",
        d.PART_NAME AS "partName",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName_textField",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.MAJOR_CODE ) AS "majorName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.SYSTEM_CODE ) AS "systemName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.EQUIP_TYPE_CODE ) AS "equipTypeName",
        ( SELECT d3.NODE_NAME FROM SYS_REGION d3 WHERE d3.NODE_CODE=d.EXT1 ) AS "stationCode",
        d.MAJOR_CODE AS "majorCode",
        d.SYSTEM_CODE AS "systemCode",
        d.EQUIP_TYPE_CODE AS "equipTypeCode",
        d.FAULT_MODULE AS "faultModule",
        d.FAULT_MODULE_ID AS "faultModuleId",
        d.FAULT_TYPE AS "faultType",
        d.SOURCE_CODE AS "sourceCode",
        d.FAULT_DISPLAY_CODE AS "faultDisplayCode",
        d.FAULT_DISPLAY_DETAIL AS "faultDisplayDetail",
        d.FAULT_DETAIL AS "faultDetail",
        d.DISCOVERER_ID AS "discovererId",
        d.DISCOVERER_PHONE AS "discovererPhone",
        d.DISCOVERER_NAME AS "discovererName",
        d.DISCOVERY_TIME AS "discoveryTime",
        d.FILLIN_USER_ID AS "fillinUserId",
        d.FILLIN_DEPT_CODE AS "fillinDeptCode",
        d.FILLIN_TIME AS "fillinTime",
        d.RESP_DEPT_CODE AS "respDeptCode",
        d.ASSIST_DEPT_CODE AS "assistDeptCode",
        d.REPAIR_DEPT_CODE AS "repairDeptCode",
        d.PUBLISH_USER_ID AS "publishUserId",
        d.PUBLISH_TIME AS "publishTime",
        d.FAULT_LEVEL AS "faultLevel",
        d.FAULT_STATUS AS "faultStatus",
        d.WORK_FLOW_INST_ID AS "workFlowInstId",
        d.WORK_FLOW_INST_STATUS AS "workFlowInstStatus",
        d.DOC_ID AS "docId",
        d.REMARK AS "remark",
        d.REC_CREATOR AS "recCreator",
        d.REC_CREATE_TIME AS "recCreateTime",
        d.REC_REVISOR AS "recRevisor",
        d.REC_REVISE_TIME AS "recReviseTime",
        d.REC_DELETOR AS "recDeletor",
        d.REC_DELETE_TIME AS "recDeleteTime",
        d.DELETE_FLAG AS "deleteFlag",
        d.ARCHIVE_FLAG AS "archiveFlag",
        d.REC_STATUS AS "recStatus",
        d.EXT1 AS "ext1",
        d.EXT2 AS "ext2",
        d.EXT3 AS "affect",
        d.EXT4 AS "ext4",
        d.EXT5 AS "ext5",
        d.TRAIN_TAG AS "traintag",
        u.USER_NAME AS "fillinUserName",
        df.CLOSE_TIME AS "closeTime",
        ( SELECT u1.USER_NAME FROM IPLAT60.XS_USER u1 WHERE u1.LOGIN_NAME=df.CLOSE_USER_ID ) AS "closeUserName",
        df.DEALER_UNIT AS "dealerUnit",
        df.DEALER_NUM AS "dealerNum",
        df.FAULT_WORK_NO AS "faultWorkNo",
        df.REC_ID AS "orderRecId",
        df.ORDER_STATUS AS "orderStatus",
        df.EXT1 AS "levelfault"
        FROM
        T_FAULT_INFO d,
        IPLAT60.XS_USER u,
        T_FAULT_ORDER df
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="req.faultType!=null">
                AND d.FAULT_TYPE=#{req.faultType}
            </if>
            <if test="req.positionCode!=null">
                AND d.POSITION_CODE=#{req.positionCode}
            </if>
            <if test="req.levelfault!=null">
                AND df.EXT1=#{req.levelfault}
            </if>
            <if test="req.faultNo!=null">
                AND d.FAULT_NO LIKE '%' || #{req.faultNo} || '%'
            </if>
            <if test="req.faultWorkNo!=null">
                AND df.FAULT_WORK_NO LIKE '%' || #{req.faultWorkNo} || '%'
            </if>
            <if test="req.orderStatus!=null and req.orderStatus!=''">
                AND df.ORDER_STATUS=#{req.orderStatus}
            </if>
            <if test="req.recStatus!=null and req.recStatus!=''">
                AND df.ORDER_STATUS <![CDATA[!=]]> #{req.recStatus}
            </if>
            <if test="req.objectCode!=null">
                AND d.OBJECT_CODE=#{req.objectCode}
            </if>
            <if test="req.objectName!=null">
                AND d.OBJECT_NAME=#{req.objectName}
            </if>
            <if test="req.majorCode!=null and req.majorCode!=''">
                AND d.MAJOR_CODE=#{req.majorCode}
            </if>
            <if test="req.systemCode!=null and req.systemCode!=''">
                AND d.SYSTEM_CODE=#{req.systemCode}
            </if>
            <if test="req.equipTypeCode!=null and req.equipTypeCode!=''">
                AND d.EQUIP_TYPE_CODE=#{req.equipTypeCode}
            </if>
            <if test="req.faultDetail!=null">
                AND d.FAULT_DETAIL LIKE '%' || #{req.faultDetail} || '%'
            </if>
            <if test="req.fillinTimeStart!=null">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &gt;= to_date(#{req.fillinTimeStart}, 'YYYY-MM-DD
                HH24:MI:SS')
            </if>
            <if test="req.fillinTimeEnd!=null">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &lt;= to_date(#{req.fillinTimeEnd}, 'YYYY-MM-DD
                HH24:MI:SS') + 1
            </if>
            <if test="req.typeCode!=null and req.typeCode!=''">
                AND df.FAULT_PROCESS_RESULT=#{req.typeCode}
            </if>
            <if test="req.faultNos!=null and req.faultNos.size() > 0">
                AND d.FAULT_NO IN
                <foreach collection="req.faultNos" item="code" open="(" close=")" separator=",">
                    #{code}
                </foreach>
            </if>
            AND d.FILLIN_USER_ID=u.LOGIN_NAME
            AND d.FAULT_NO=df.FAULT_NO
            AND d.FAULT_FLAG <![CDATA[!=]]> '2'
            and d.DELETE_FLAG = '0'
        </trim>
        ORDER BY df.ORDER_STATUS asc, d.FAULT_NO desc,df.FAULT_WORK_NO desc
    </select>
    <select id="queryOrderStatus" resultType="java.lang.String">
        select
        df2.ORDER_STATUS
        from T_FAULT_INFO df1,T_FAULT_ORDER df2
        where 1=1 and df1.FAULT_NO=df2.FAULT_NO
        <if test="reqDTO.id!=null">
            AND df2.FAULT_WORK_NO=#{reqDTO.id}
        </if>
    </select>
    <select id="construction" resultType="com.wzmtr.eam.dto.res.fault.ConstructionResDTO">
        SELECT
        REC_ID AS "recId",  <!-- 记录编号 -->
        SYSCODE AS "syscode",  <!-- 系统编码 -->
        OPER_TYPE AS "operType",  <!-- 操作类型 -->
        WORKPN AS "workpn",  <!-- 施工计划代码 -->
        WORKNO AS "workNo",  <!-- 工单号 -->
        WORKORDER AS "workorder",  <!-- 工单类型 -->
        PLANTIME AS "plantime",  <!-- 提报批准时间 -->
        CIRCULARTIME AS "circulartime",  <!-- 通告时间 -->
        PLANWORKER AS "planworker",  <!-- 提报人 -->
        CONSTLEADER AS "constleader",  <!-- 施工负责人 -->
        REMARK AS "remark",  <!-- 备注 -->
        REC_CREATOR AS "recCreator",  <!-- 创建者 -->
        REC_CREATE_TIME AS "recCreateTime",  <!-- 创建时间 -->
        REC_REVISOR AS "recRevisor",  <!-- 修改者 -->
        REC_REVISE_TIME AS "recReviseTime",  <!-- 修改时间 -->
        REC_DELETOR AS "recDeletor",  <!-- 删除者 -->
        REC_DELETE_TIME AS "recDeleteTime",  <!-- 删除时间 -->
        DELETE_FLAG AS "deleteFlag",  <!-- 删除标志 -->
        ARCHIVE_FLAG AS "archiveFlag",  <!-- 归档标记 -->
        REC_STATUS AS "recStatus",  <!-- 记录状态 -->
        EXT1 AS "ext1",  <!-- 扩展字段1 -->
        EXT2 AS "ext2",  <!-- 扩展字段2 -->
        EXT3 AS "ext3",  <!-- 扩展字段3 -->
        EXT4 AS "ext4",  <!-- 扩展字段4 -->
        EXT5 AS "ext5"  <!-- 扩展字段5 -->
        FROM T_WORK_PLAN
        WHERE 1=1
        <if test="faultWorkNo!=null">
            AND WORKNO=#{faultWorkNo}
        </if>
        ORDER BY REC_ID ASC
    </select>

    <select id="cancellation" resultType="com.wzmtr.eam.dto.res.fault.ConstructionResDTO">
        SELECT
        REC_ID as "recId",  <!-- 记录编号 -->
        SYSCODE as "syscode",  <!-- 系统编码 -->
        OPER_TYPE as "operType",  <!-- 操作类型 -->
        WORKPN as "workpn",  <!-- 施工计划代码 -->
        WORKNO as "workno",  <!-- 检修工单号 -->
        WORKORDER as "workorder",  <!-- 工单类型 -->
        APPLYTIME as "applytime",  <!-- 请点批准时间 -->
        DELAYTIME as "delaytime",  <!-- 销点批准时间 -->
        CONSTLEADER as "constleader",  <!-- 施工负责人 -->
        WORKERSUM as "workersum",  <!-- 施工人数 -->
        DEVICESUM as "devicesum",  <!-- 携带工器具数量 -->
        MASTERAPPSTAITON as "masterappstaiton",  <!-- 请点主站 -->
        MASTERDELSTAITON as "masterdelstaiton",  <!-- 销点主站 -->
        MASTERSTAITON as "masterstaiton",  <!-- 辅站 -->
        FINISHSTATUS as "finishstatus",  <!-- 是否完成 -->
        REMARK as "remark",  <!-- 完成情况 -->
        REASON as "reason",  <!-- 未完成原因 -->
        REMARKS as "remarks",  <!-- 备注 -->
        REC_CREATOR as "recCreator",  <!-- 创建者 -->
        REC_CREATE_TIME as "recCreateTime",  <!-- 创建时间 -->
        REC_REVISOR as "recRevisor",  <!-- 修改者 -->
        REC_REVISE_TIME as "recReviseTime",  <!-- 修改时间 -->
        REC_DELETOR as "recDeletor",  <!-- 删除者 -->
        REC_DELETE_TIME as "recDeleteTime",  <!-- 删除时间 -->
        DELETE_FLAG as "deleteFlag",  <!-- 删除标志 -->
        ARCHIVE_FLAG as "archiveFlag",  <!-- 归档标记 -->
        REC_STATUS as "recStatus",  <!-- 记录状态 -->
        EXT1 as "ext1",  <!-- 扩展字段1 -->
        EXT2 as "ext2",  <!-- 扩展字段2 -->
        EXT3 as "ext3",  <!-- 扩展字段3 -->
        EXT4 as "ext4",  <!-- 扩展字段4 -->
        EXT5 as "ext5" <!-- 扩展字段5 -->
        FROM T_REQUEST_POINTS WHERE 1=1
        <if test="faultWorkNo!=null">
            AND WORKNO=#{faultWorkNo}
        </if>
        order by REC_ID asc
    </select>
    <select id="export" resultType="com.wzmtr.eam.dto.res.fault.FaultDetailResDTO">
        SELECT
        d.REC_ID AS recId,
        df.REC_ID AS workId,
        df.WORK_CLASS AS workClass,
        d.COMPANY_CODE AS companyCode,
        d.COMPANY_NAME AS companyName,
        d.FAULT_NO AS faultNo,
        d.FAULT_FLAG AS faultFlag,
        d.OBJECT_CODE AS objectCode,
        d.OBJECT_CODE AS objectCode_textField,
        d.OBJECT_NAME AS objectName,
        d.TRAIN_TRUNK AS trainTrunk,
        (SELECT ec.ITEM_CNAME FROM iplat60.tedcm01 ec WHERE ec.ITEM_CODE=d.LINE_CODE AND ec.CODESET_CODE='line') AS
        lineName,
        d.LINE_CODE AS lineCode,
        d.POSITION_CODE AS positionCode,
        d.POSITION2_CODE AS position2Code,
        d.PART_CODE AS partCode,
        d.PART_NAME AS partName,
        (SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE) AS positionName_textField,
        (SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE) AS positionName,
        (SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.MAJOR_CODE) AS majorName,
        (SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.SYSTEM_CODE) AS systemName,
        (SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.EQUIP_TYPE_CODE) AS equipTypeName,
        (SELECT d3.NODE_NAME FROM SYS_REGION d3 WHERE d3.NODE_CODE=d.EXT1) AS stationCode,
        d.MAJOR_CODE AS majorCode,
        d.SYSTEM_CODE AS systemCode,
        d.EQUIP_TYPE_CODE AS equipTypeCode,
        d.FAULT_MODULE AS faultModule,
        d.FAULT_MODULE_ID AS faultModuleId,
        d.FAULT_TYPE AS faultType,
        d.SOURCE_CODE AS sourceCode,
        d.FAULT_DISPLAY_CODE AS faultDisplayCode,
        d.FAULT_DISPLAY_DETAIL AS faultDisplayDetail,
        d.FAULT_DETAIL AS faultDetail,
        d.DISCOVERER_ID AS discovererId,
        d.DISCOVERER_PHONE AS discovererPhone,
        d.DISCOVERER_NAME AS discovererName,
        d.DISCOVERY_TIME AS discoveryTime,
        d.FILLIN_USER_ID AS fillinUserId,
        d.FILLIN_DEPT_CODE AS fillinDeptCode,
        d.FILLIN_TIME AS fillinTime,
        d.RESP_DEPT_CODE AS respDeptCode,
        d.ASSIST_DEPT_CODE AS assistDeptCode,
        d.REPAIR_DEPT_CODE AS repairDeptCode,
        d.PUBLISH_USER_ID AS publishUserId,
        d.PUBLISH_TIME AS publishTime,
        d.FAULT_LEVEL AS faultLevel,
        d.FAULT_STATUS AS faultStatus,
        d.WORK_FLOW_INST_ID AS workFlowInstId,
        d.WORK_FLOW_INST_STATUS AS workFlowInstStatus,
        d.DOC_ID AS docId,
        d.REMARK AS remark,
        d.REC_CREATOR AS recCreator,
        d.REC_CREATE_TIME AS recCreateTime,
        d.REC_REVISOR AS recRevisor,
        d.REC_REVISE_TIME AS recReviseTime,
        d.REC_DELETOR AS recDeletor,
        d.REC_DELETE_TIME AS recDeleteTime,
        d.DELETE_FLAG AS deleteFlag,
        d.ARCHIVE_FLAG AS archiveFlag,
        d.REC_STATUS AS recStatus,
        d.EXT1 AS ext1,
        d.EXT2 AS ext2,
        d.EXT3 AS affect,
        d.EXT4 AS ext4,
        d.EXT5 AS ext5,
        d.TRAIN_TAG AS traintag,
        u.USER_NAME AS fillinUserName,
        df.CLOSE_TIME AS closeTime,
        (SELECT u1.USER_NAME FROM IPLAT60.XS_USER u1 WHERE u1.LOGIN_NAME=df.CLOSE_USER_ID) AS closeUserName,
        df.DEALER_UNIT AS dealerUnit,
        df.DEALER_NUM AS dealerNum,
        df.FAULT_WORK_NO AS faultWorkNo,
        df.REC_ID AS orderRecId,
        df.ORDER_STATUS AS orderStatus,
        df.EXT1 AS levelfault,
        (
        CASE
        WHEN TO_DATE(d.FILLIN_TIME, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[<]]> TO_DATE(SYSDATE - 20) AND
        (df.ORDER_STATUS='10' OR df.ORDER_STATUS='20' OR df.ORDER_STATUS='30') AND
        df.ORDER_STATUS!='99' AND df.ORDER_STATUS!='60' AND df.ORDER_STATUS!='70' THEN 1
        WHEN TO_DATE(d.FILLIN_TIME, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[>=]]> TO_DATE(SYSDATE - 20) AND
        TO_DATE(d.FILLIN_TIME, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[<=]]> TO_DATE(SYSDATE - 10) AND
        (df.ORDER_STATUS='10' OR df.ORDER_STATUS='20' OR df.ORDER_STATUS='30') AND
        df.ORDER_STATUS!='99' AND df.ORDER_STATUS!='60' AND df.ORDER_STATUS!='70' THEN 2
        WHEN TO_DATE(d.FILLIN_TIME, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[>=]]> TO_DATE(SYSDATE - 10) AND
        (df.ORDER_STATUS='10' OR df.ORDER_STATUS='20' OR df.ORDER_STATUS='30') AND
        df.ORDER_STATUS!='99' AND df.ORDER_STATUS!='60' AND df.ORDER_STATUS!='70' THEN 3
        ELSE 9
        END
        ) AS sort
        FROM T_FAULT_INFO d
        INNER JOIN IPLAT60.XS_USER u ON d.FILLIN_USER_ID=u.LOGIN_NAME
        INNER JOIN T_FAULT_ORDER df ON d.FAULT_NO=df.FAULT_NO AND d.FAULT_FLAG!='2'
        WHERE 1=1 and d.DELETE_FLAG = '0'
        <if test="faultType!=null">
            AND d.FAULT_TYPE=#{faultType}
        </if>
        <if test="positionCode!=null">
            AND d.POSITION_CODE=#{positionCode}
        </if>
        <if test="orderStatus!=null">
            AND df.ORDER_STATUS=#{orderStatus}
        </if>
        <if test="objectCode!=null">
            AND d.OBJECT_CODE=#{objectCode}
        </if>
        <if test="objectName!=null">
            AND d.OBJECT_NAME=#{objectName}
        </if>
        <if test="majorCode!=null">
            AND d.MAJOR_CODE=#{majorCode}
        </if>
        <if test="systemCode!=null">
            AND d.SYSTEM_CODE=#{systemCode}
        </if>
        <if test="equipTypeCode!=null">
            AND d.EQUIP_TYPE_CODE=#{equipTypeCode}
        </if>
        <if test="faultDetail!=null">
            AND d.FAULT_DETAIL LIKE '%' || #{faultDetail} || '%'
        </if>
        <if test="fillinTimeStart!=null">
            AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &gt;= to_date(#{fillinTimeStart}, 'YYYY-MM-DD')
        </if>
        <if test="fillinTimeEnd!=null">
            AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &lt;= to_date(#{fillinTimeEnd}, 'YYYY-MM-DD') + 1
        </if>
        <if test="faultNos!=null and faultNos.size() > 0">
            AND d.FAULT_NO IN
            <foreach collection="faultNos" item="code" open="(" close=")" separator=",">
                #{code}
            </foreach>
        </if>
        <if test="faultWorkNos!=null and faultWorkNos.size() > 0">
            AND df.FAULT_WORK_NO IN
            <foreach collection="faultWorkNos" item="code" open="(" close=")" separator=",">
                #{code}
            </foreach>
        </if>
        ORDER BY sort, df.ORDER_STATUS ASC, d.FAULT_NO DESC, df.FAULT_WORK_NO DESC
    </select>
    <select id="queryOneFaultInfo" resultType="com.wzmtr.eam.dataobject.FaultInfoDO">
        SELECT
        d.REC_ID AS "recId",
        d.COMPANY_CODE AS "companyCode",
        d.COMPANY_NAME AS "companyName",
        d.FAULT_NO AS "faultNo",
        d.FAULT_FLAG AS "faultFlag",
        d.OBJECT_CODE AS "objectCode",
        d.OBJECT_CODE AS "objectCode_textField",
        d.OBJECT_NAME AS "objectName",
        d.TRAIN_TRUNK AS "trainTrunk",
        ( SELECT ec.ITEM_CNAME FROM iplat60.tedcm01 ec WHERE ec.ITEM_CODE=d.LINE_CODE AND ec.CODESET_CODE='line' )
        AS
        "lineName",
        d.LINE_CODE AS "lineCode",
        d.POSITION_CODE AS "positionCode",
        d.POSITION2_CODE AS "position2Code",
        d.PART_CODE AS "partCode",
        d.PART_NAME AS "partName",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName_textField",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.MAJOR_CODE ) AS "majorName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.SYSTEM_CODE ) AS "systemName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.EQUIP_TYPE_CODE ) AS "equipTypeName",
        ( SELECT d3.NODE_NAME FROM SYS_REGION d3 WHERE d3.NODE_CODE=d.EXT1 ) AS "stationCode",
        d.MAJOR_CODE AS "majorCode",
        d.SYSTEM_CODE AS "systemCode",
        d.EQUIP_TYPE_CODE AS "equipTypeCode",
        d.FAULT_MODULE AS "faultModule",
        d.FAULT_MODULE_ID AS "faultModuleId",
        d.FAULT_TYPE AS "faultType",
        d.SOURCE_CODE AS "sourceCode",
        d.FAULT_DISPLAY_CODE AS "faultDisplayCode",
        d.FAULT_DISPLAY_DETAIL AS "faultDisplayDetail",
        d.FAULT_DETAIL AS "faultDetail",
        d.DISCOVERER_ID AS "discovererId",
        d.DISCOVERER_PHONE AS "discovererPhone",
        d.DISCOVERER_NAME AS "discovererName",
        d.DISCOVERY_TIME AS "discoveryTime",
        d.FILLIN_USER_ID AS "fillinUserId",
        d.FILLIN_DEPT_CODE AS "fillinDeptCode",
        d.FILLIN_TIME AS "fillinTime",
        d.RESP_DEPT_CODE AS "respDeptCode",
        d.ASSIST_DEPT_CODE AS "assistDeptCode",
        d.REPAIR_DEPT_CODE AS "repairDeptCode",
        d.PUBLISH_USER_ID AS "publishUserId",
        d.PUBLISH_TIME AS "publishTime",
        d.FAULT_LEVEL AS "faultLevel",
        d.FAULT_STATUS AS "faultStatus",
        d.WORK_FLOW_INST_ID AS "workFlowInstId",
        d.WORK_FLOW_INST_STATUS AS "workFlowInstStatus",
        d.DOC_ID AS "docId",
        d.REMARK AS "remark",
        d.REC_CREATOR AS "recCreator",
        d.REC_CREATE_TIME AS "recCreateTime",
        d.REC_REVISOR AS "recRevisor",
        d.REC_REVISE_TIME AS "recReviseTime",
        d.REC_DELETOR AS "recDeletor",
        d.REC_DELETE_TIME AS "recDeleteTime",
        d.DELETE_FLAG AS "deleteFlag",
        d.ARCHIVE_FLAG AS "archiveFlag",
        d.REC_STATUS AS "recStatus",
        d.EXT1 AS "ext1",
        d.EXT2 AS "ext2",
        d.EXT3 AS "affect",
        d.EXT4 AS "ext4",
        d.EXT5 AS "ext5",
        d.TRAIN_TAG AS "traintag"
        FROM
        T_FAULT_INFO d
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="faultNo!=null">
                and d.FAULT_NO LIKE '%' || #{faultNo} || '%'
            </if>
        </trim>
    </select>
    <select id="queryOneFaultOrder" resultType="com.wzmtr.eam.dataobject.FaultOrderDO">
        SELECT
        REC_ID as "recId",
        COMPANY_CODE as "companyCode",
        COMPANY_NAME as "companyName",
        FAULT_NO as "faultNo",
        FAULT_WORK_NO as "faultWorkNo",
        DISPATCH_USER_ID as "dispatchUserId",
        DISPATCH_TIME as "dispatchTime",
        REPAIR_RESP_USER_ID as "repairRespUserId",
        WORK_AREA as "workArea",
        ORDER_STATUS as "orderStatus",
        REPAIR_DISPATCH_NO as "repairDispatchNo",
        REPORT_USER_ID as "reportUserId",
        REPORT_TIME as "reportTime",
        WORK_CLASS as "workClass",
        CHECK_USER_ID as "checkUserId",
        CHECK_TIME as "checkTime",
        RUSH_REPAIR_NO as "rushRepairNo",
        ARRIVAL_TIME as "arrivalTime",
        REPAIR_START_TIME as "repairStartTime",
        REPAIR_END_TIME as "repairEndTime",
        REPAIR_TIME as "repairTime",
        LEAVE_TIME as "leaveTime",
        FAULT_REASON_CODE as "faultReasonCode",
        FAULT_REASON_DETAIL as "faultReasonDetail",
        FAULT_ACTION_CODE as "faultActionCode",
        FAULT_ACTION_DETAIL as "faultActionDetail",
        FAULT_PROCESS_RESULT as "faultProcessResult",
        REPORT_START_USER_ID as "reportStartUserId",
        REPORT_START_TIME as "reportStartTime",
        REPORT_FINISH_USER_ID as "reportFinishUserId",
        REPORT_FINISH_TIME as "reportFinishTime",
        CONFIRM_USER_ID as "confirmUserId",
        CONFIRM_TIME as "confirmTime",
        CLOSE_USER_ID as "closeUserId",
        CLOSE_TIME as "closeTime",
        WORK_FLOW_INST_ID as "workFlowInstId",
        WORK_FLOW_INST_STATUS as "workFlowInstStatus",
        PLAN_RECOVERY_TIME as "planRecoveryTime",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(DISPATCH_USER_ID)) as "dispatchUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(REPAIR_RESP_USER_ID)) as
        "repairRespUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(CHECK_USER_ID)) as "checkUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(CLOSE_USER_ID)) as "closeUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(REPORT_FINISH_USER_ID)) as
        "reportFinishUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(CONFIRM_USER_ID)) as "confirmUserName",
        (SELECT u.USER_NAME FROM IPLAT60.XS_USER u WHERE u.LOGIN_NAME=TRIM(REPORT_USER_ID)) as "reportUserName",
        FAULT_AFFECT as "faultAffect",
        IS_DETAINING_REPAIR as "isDetainingRepair",
        DOC_ID as "docId",
        REMARK as "remark",
        REC_CREATOR as "recCreator",
        REC_CREATE_TIME as "recCreateTime",
        REC_REVISOR as "recRevisor",
        REC_REVISE_TIME as "recReviseTime",
        REC_DELETOR as "recDeletor",
        REC_DELETE_TIME as "recDeleteTime",
        DELETE_FLAG as "deleteFlag",
        ARCHIVE_FLAG as "archiveFlag",
        REC_STATUS as "recStatus",
        EXT1 as "levelfault",
        EXT2 as "ext2",
        EXT3 as "ext3",
        EXT4 as "ext4",
        EXT5 as "ext5"
        FROM T_FAULT_ORDER
        WHERE 1=1
        <if test="faultWorkNo!=null and faultWorkNo!=''">
            AND FAULT_WORK_NO=#{faultWorkNo}
        </if>
        <if test="faultNo!=null and faultNo!=''">
            AND FAULT_NO=#{faultNo}
        </if>
        order by FAULT_WORK_NO DESC
    </select>
    <select id="queryDetail" resultType="com.wzmtr.eam.dto.res.fault.FaultDetailResDTO">
        SELECT
        d.REC_ID AS "recId",
        df.REC_ID AS "workId",
        df.WORK_CLASS AS "workClass",
        d.COMPANY_CODE AS "companyCode",
        d.COMPANY_NAME AS "companyName",
        d.FAULT_NO AS "faultNo",
        d.FAULT_FLAG AS "faultFlag",
        d.OBJECT_CODE AS "objectCode",
        d.OBJECT_CODE AS "objectCode_textField",
        d.OBJECT_NAME AS "objectName",
        d.TRAIN_TRUNK AS "trainTrunk",
        ( SELECT ec.ITEM_CNAME FROM iplat60.tedcm01 ec WHERE ec.ITEM_CODE=d.LINE_CODE AND ec.CODESET_CODE='line' )
        AS
        "lineName",
        d.LINE_CODE AS "lineCode",
        d.POSITION_CODE AS "positionCode",
        d.POSITION2_CODE AS "position2Code",
        d.PART_CODE AS "partCode",
        d.PART_NAME AS "partName",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName_textField",
        ( SELECT db.NODE_NAME FROM SYS_REGION db WHERE db.NODE_CODE=d.POSITION_CODE ) AS "positionName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.MAJOR_CODE ) AS "majorName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.SYSTEM_CODE ) AS "systemName",
        ( SELECT db.NODE_NAME FROM T_EQUIPMENT_CATEGORY db WHERE db.NODE_CODE=d.EQUIP_TYPE_CODE ) AS "equipTypeName",
        ( SELECT d3.NODE_NAME FROM SYS_REGION d3 WHERE d3.NODE_CODE=d.EXT1 ) AS "stationCode",
        d.MAJOR_CODE AS "majorCode",
        d.SYSTEM_CODE AS "systemCode",
        d.EQUIP_TYPE_CODE AS "equipTypeCode",
        d.FAULT_MODULE AS "faultModule",
        d.FAULT_MODULE_ID AS "faultModuleId",
        d.FAULT_TYPE AS "faultType",
        d.SOURCE_CODE AS "sourceCode",
        d.FAULT_DISPLAY_CODE AS "faultDisplayCode",
        d.FAULT_DISPLAY_DETAIL AS "faultDisplayDetail",
        d.FAULT_DETAIL AS "faultDetail",
        d.DISCOVERER_ID AS "discovererId",
        d.DISCOVERER_PHONE AS "discovererPhone",
        d.DISCOVERER_NAME AS "discovererName",
        d.DISCOVERY_TIME AS "discoveryTime",
        d.FILLIN_USER_ID AS "fillinUserId",
        d.FILLIN_DEPT_CODE AS "fillinDeptCode",
        d.FILLIN_TIME AS "fillinTime",
        d.RESP_DEPT_CODE AS "respDeptCode",
        d.ASSIST_DEPT_CODE AS "assistDeptCode",
        d.REPAIR_DEPT_CODE AS "repairDeptCode",
        d.PUBLISH_USER_ID AS "publishUserId",
        d.PUBLISH_TIME AS "publishTime",
        d.FAULT_LEVEL AS "faultLevel",
        d.FAULT_STATUS AS "faultStatus",
        d.WORK_FLOW_INST_ID AS "workFlowInstId",
        d.WORK_FLOW_INST_STATUS AS "workFlowInstStatus",
        d.DOC_ID AS "docId",
        d.REMARK AS "remark",
        d.REC_CREATOR AS "recCreator",
        d.REC_CREATE_TIME AS "recCreateTime",
        d.REC_REVISOR AS "recRevisor",
        d.REC_REVISE_TIME AS "recReviseTime",
        d.REC_DELETOR AS "recDeletor",
        d.REC_DELETE_TIME AS "recDeleteTime",
        d.DELETE_FLAG AS "deleteFlag",
        d.ARCHIVE_FLAG AS "archiveFlag",
        d.REC_STATUS AS "recStatus",
        d.EXT1 AS "ext1",
        d.EXT2 AS "ext2",
        d.EXT3 AS "affect",
        d.EXT4 AS "ext4",
        d.EXT5 AS "ext5",
        d.TRAIN_TAG AS "traintag",
        u.USER_NAME AS "fillinUserName",
        df.CLOSE_TIME AS "closeTime",
        ( SELECT u1.USER_NAME FROM IPLAT60.XS_USER u1 WHERE u1.LOGIN_NAME=df.CLOSE_USER_ID ) AS "closeUserName",
        df.DEALER_UNIT AS "dealerUnit",
        df.DEALER_NUM AS "dealerNum",
        df.FAULT_WORK_NO AS "faultWorkNo",
        df.REC_ID AS "orderRecId",
        df.ORDER_STATUS AS "orderStatus",
        df.EXT1 AS "levelfault"
        FROM
        T_FAULT_INFO d,
        IPLAT60.XS_USER u,
        T_FAULT_ORDER df
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="req.faultType!=null">
                AND d.FAULT_TYPE=#{req.faultType}
            </if>
            <if test="req.positionCode!=null">
                AND d.POSITION_CODE=#{req.positionCode}
            </if>
            <if test="req.faultNo!=null">
                AND d.FAULT_NO LIKE '%' || #{req.faultNo} || '%'
            </if>
            <if test="req.faultWorkNo!=null">
                AND df.FAULT_WORK_NO LIKE '%' || #{req.faultWorkNo} || '%'
            </if>
            <if test="req.orderStatus!=null and req.orderStatus!=''">
                AND df.ORDER_STATUS=#{req.orderStatus}
            </if>
            <if test="req.recStatus!=null and req.recStatus!=''">
                AND df.ORDER_STATUS <![CDATA[!=]]> #{req.recStatus}
            </if>
            <if test="req.objectCode!=null">
                AND d.OBJECT_CODE=#{req.objectCode}
            </if>
            <if test="req.objectName!=null">
                AND d.OBJECT_NAME=#{req.objectName}
            </if>
            <if test="req.majorCode!=null">
                AND d.MAJOR_CODE=#{req.majorCode}
            </if>
            <if test="req.systemCode!=null and req.systemCode!=''">
                AND d.SYSTEM_CODE=#{req.systemCode}
            </if>
            <if test="req.equipTypeCode!=null and req.equipTypeCode!=''">
                AND d.EQUIP_TYPE_CODE=#{req.equipTypeCode}
            </if>
            <if test="req.faultDetail!=null">
                AND d.FAULT_DETAIL LIKE '%' || #{req.faultDetail} || '%'
            </if>
            <if test="req.fillinTimeStart!=null">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &gt;= to_date(#{req.fillinTimeStart}, 'YYYY-MM-DD')
            </if>
            <if test="req.fillinTimeEnd!=null">
                AND to_date(d.FILLIN_TIME, 'YYYY-MM-DD HH24:MI:SS') &lt;= to_date(#{req.fillinTimeEnd}, 'YYYY-MM-DD') +
                1
            </if>
            AND d.FILLIN_USER_ID=u.LOGIN_NAME
            AND d.FAULT_NO=df.FAULT_NO
            AND d.FAULT_FLAG <![CDATA[!=]]> '2'
        </trim>
        ORDER BY df.ORDER_STATUS asc, d.FAULT_NO desc,df.FAULT_WORK_NO desc
    </select>
    <select id="queryDeptCode" resultType="com.wzmtr.eam.dto.res.basic.FaultRepairDeptResDTO">
        SELECT d5.ORG_CODE as "orgCode", d5.ORG_NAME as "orgName"
        FROM SYS_ORG_MAJOR d5,
        SYS_ORG_LINE d6,
        SYS_ORG_TYPE d7
        where d5.ORG_CODE=d6.ORG_CODE
        AND d6.ORG_CODE=d7.ORG_CODE
        <if test="majorCode!=null and majorCode!=''">
            AND d5.MAJOR_CODE=#{majorCode}
        </if>
        <if test="lineCode!=null and lineCode!=''">
            AND d6.LINE_CODE=#{lineCode}
        </if>
        <if test="orgType!=null and orgType!=''">
            AND d7.ORG_TYPE=#{orgType}
        </if>
    </select>
</mapper>
